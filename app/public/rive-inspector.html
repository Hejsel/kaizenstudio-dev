<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rive File Inspector</title>
    <script src="https://unpkg.com/@rive-app/canvas@2.23.8"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            margin-bottom: 10px;
            color: #1e40af;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .file-selector {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 6px;
        }

        .file-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .file-selector select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 4px;
            background: white;
        }

        .preview-section {
            margin-bottom: 30px;
        }

        canvas {
            width: 100%;
            max-width: 600px;
            height: 400px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            display: block;
            margin: 0 auto;
        }

        .metadata {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .metadata-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid #1e40af;
        }

        .metadata-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #1e40af;
        }

        .metadata-section h3 {
            font-size: 16px;
            margin: 15px 0 10px 0;
            color: #4b5563;
        }

        .metadata-list {
            list-style: none;
        }

        .metadata-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .metadata-list li:last-child {
            border-bottom: none;
        }

        .label {
            font-weight: 600;
            color: #6b7280;
            display: inline-block;
            min-width: 120px;
        }

        .value {
            color: #1f2937;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            background: #dbeafe;
            color: #1e40af;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .badge.number { background: #fef3c7; color: #92400e; }
        .badge.boolean { background: #dcfce7; color: #166534; }
        .badge.trigger { background: #fce7f3; color: #9f1239; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .error {
            background: #fef2f2;
            border-left-color: #dc2626;
            color: #991b1b;
        }

        .empty {
            color: #9ca3af;
            font-style: italic;
        }

        .json-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Rive File Inspector</h1>
        <p class="subtitle">Inspic√©r hvad en .riv fil indeholder af metadata og egenskaber</p>

        <div class="file-selector">
            <label for="riveFile">V√¶lg en .riv fil at inspicere:</label>
            <select id="riveFile">
                <option value="">-- V√¶lg fil --</option>
                <option value="http://kaizenstudio-dev.local/wp-content/uploads/2025/11/20749-39045-glowing-subscribe-button.riv">glowing-subscribe-button.riv</option>
                <option value="http://kaizenstudio-dev.local/wp-content/uploads/2025/11/20749-39045-glowing-subscribe-button-1.riv">glowing-subscribe-button-1.riv</option>
                <option value="http://kaizenstudio-dev.local/wp-content/uploads/2025/11/24941-46557-expression-grid.riv">expression-grid.riv</option>
            </select>
        </div>

        <div class="preview-section">
            <h2>Preview</h2>
            <canvas id="riveCanvas"></canvas>
        </div>

        <div id="metadata" class="metadata"></div>
    </div>

    <script>
        let currentRive = null;

        document.getElementById('riveFile').addEventListener('change', function(e) {
            const filePath = e.target.value;
            if (!filePath) return;

            inspectRiveFile(filePath);
        });

        function inspectRiveFile(src) {
            // Cleanup previous instance
            if (currentRive) {
                currentRive.cleanup();
                currentRive = null;
            }

            const canvas = document.getElementById('riveCanvas');
            const metadataContainer = document.getElementById('metadata');

            metadataContainer.innerHTML = '<div class="loading">Loader .riv fil...</div>';

            console.log('üîÑ Attempting to load Rive file:', src);

            // First, test if we can fetch the file
            fetch(src)
                .then(response => {
                    console.log('üì• Fetch response:', response);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.arrayBuffer();
                })
                .then(buffer => {
                    console.log('‚úÖ File fetched successfully, size:', buffer.byteLength, 'bytes');
                })
                .catch(error => {
                    console.error('‚ùå Fetch failed:', error);
                });

            // Check if Rive library is loaded
            console.log('üìö Rive library available:', typeof rive !== 'undefined');
            console.log('üìö Rive constructor:', rive?.Rive);

            // Create Rive instance
            try {
                currentRive = new rive.Rive({
                    src: src,
                    canvas: canvas,
                    autoplay: true,
                    useOffscreenRenderer: true,
                    onLoad: () => {
                        console.log('‚úÖ Rive loaded successfully');
                        console.log('üì¶ Rive instance:', currentRive);
                        displayMetadata(currentRive);
                    },
                    onLoadError: (error) => {
                        console.error('‚ùå Error loading Rive file');
                        console.error('Error object:', error);
                        console.error('Error type:', typeof error);
                        console.error('Error keys:', error ? Object.keys(error) : 'null');
                        console.error('Error message:', error?.message);
                        console.error('Error toString:', error?.toString());
                        console.error('File URL:', src);

                        let errorMessage = 'Ukendt fejl';
                        if (error) {
                            if (typeof error === 'string') {
                                errorMessage = error;
                            } else if (error.message) {
                                errorMessage = error.message;
                            } else if (error.toString) {
                                errorMessage = error.toString();
                            } else {
                                errorMessage = JSON.stringify(error);
                            }
                        }

                        metadataContainer.innerHTML = `
                            <div class="metadata-section error">
                                <h2>Fejl ved indl√¶sning</h2>
                                <p><strong>Fil:</strong> ${src}</p>
                                <p><strong>Fejl:</strong> ${errorMessage}</p>
                                <p><strong>Error type:</strong> ${typeof error}</p>
                                <p style="margin-top: 15px;">Mulige √•rsager:</p>
                                <ul style="margin-left: 20px; margin-top: 10px;">
                                    <li>Filen findes ikke p√• serveren</li>
                                    <li>CORS-fejl (Cross-Origin Resource Sharing)</li>
                                    <li>Filen er korrupt eller ikke en gyldig .riv fil</li>
                                    <li>Network fejl</li>
                                </ul>
                                <p style="margin-top: 15px;"><strong>Check konsollen (F12) for flere detaljer.</strong></p>
                            </div>
                        `;
                    }
                });
            } catch (error) {
                console.error('üí• Exception creating Rive instance:', error);
                metadataContainer.innerHTML = `
                    <div class="metadata-section error">
                        <h2>JavaScript Fejl</h2>
                        <p><strong>Exception:</strong> ${error.message}</p>
                        <pre class="json-output" style="background: #991b1b; color: white;">${error.stack}</pre>
                    </div>
                `;
            }
        }

        function displayMetadata(riveInstance) {
            const metadata = {
                // Basic info
                isPlaying: riveInstance.isPlaying,
                isPaused: riveInstance.isPaused,
                isStopped: riveInstance.isStopped,

                // Artboards
                artboardNames: riveInstance.artboardNames || [],

                // Animations
                animationNames: riveInstance.animationNames || [],

                // State Machines
                stateMachineNames: riveInstance.stateMachineNames || [],

                // Current playback
                playingStateMachineNames: riveInstance.playingStateMachineNames || [],
                playingAnimationNames: riveInstance.playingAnimationNames || [],

                // Inputs (from all state machines)
                stateMachineInputs: [],

                // Layout info
                layout: riveInstance.layout,
                bounds: riveInstance.bounds,

                // Full instance properties (for debugging)
                allProperties: []
            };

            // Get inputs from each state machine
            if (metadata.stateMachineNames.length > 0) {
                metadata.stateMachineNames.forEach(smName => {
                    try {
                        const inputs = riveInstance.stateMachineInputs(smName);
                        if (inputs && inputs.length > 0) {
                            inputs.forEach(input => {
                                metadata.stateMachineInputs.push({
                                    stateMachine: smName,
                                    name: input.name,
                                    type: input.type,
                                    value: input.value
                                });
                            });
                        }
                    } catch (error) {
                        console.warn(`Could not get inputs for state machine: ${smName}`, error);
                    }
                });
            }

            // Get ALL properties from the Rive instance (deep inspection)
            console.log('üîç FULL RIVE INSTANCE:', riveInstance);

            // Try to access internal properties
            try {
                // Check for runtime object (low-level access)
                if (riveInstance._riveInstance) {
                    console.log('üì¶ Internal _riveInstance:', riveInstance._riveInstance);
                }

                // List all enumerable properties
                for (let prop in riveInstance) {
                    try {
                        const value = riveInstance[prop];
                        const type = typeof value;

                        metadata.allProperties.push({
                            name: prop,
                            type: type,
                            value: type === 'function' ? '[Function]' : value
                        });
                    } catch (e) {
                        metadata.allProperties.push({
                            name: prop,
                            type: 'error',
                            value: 'Could not access'
                        });
                    }
                }
            } catch (error) {
                console.warn('Could not enumerate properties:', error);
            }

            console.log('üìä Complete Metadata:', metadata);
            console.log('üìä All Properties:', metadata.allProperties);

            renderMetadata(metadata, riveInstance);
        }

        function renderMetadata(data, riveInstance) {
            const container = document.getElementById('metadata');

            let html = `
                <!-- Basic Info -->
                <div class="metadata-section">
                    <h2>üìå Basic Information</h2>
                    <ul class="metadata-list">
                        <li><span class="label">Status:</span> <span class="value">${data.isPlaying ? 'Playing' : data.isPaused ? 'Paused' : 'Stopped'}</span></li>
                    </ul>
                </div>

                <!-- Artboards -->
                <div class="metadata-section">
                    <h2>üé® Artboards (${data.artboardNames.length})</h2>
                    ${data.artboardNames.length > 0
                        ? data.artboardNames.map(name => `<span class="badge">${name}</span>`).join('')
                        : '<p class="empty">Ingen artboards fundet</p>'}
                </div>

                <!-- Animations -->
                <div class="metadata-section">
                    <h2>üé¨ Animations (${data.animationNames.length})</h2>
                    ${data.animationNames.length > 0
                        ? data.animationNames.map(name => `<span class="badge">${name}</span>`).join('')
                        : '<p class="empty">Ingen animations fundet</p>'}
                    ${data.playingAnimationNames.length > 0
                        ? `<h3>Afspiller nu:</h3>${data.playingAnimationNames.map(name => `<span class="badge">${name}</span>`).join('')}`
                        : ''}
                </div>

                <!-- State Machines -->
                <div class="metadata-section">
                    <h2>‚öôÔ∏è State Machines (${data.stateMachineNames.length})</h2>
                    ${data.stateMachineNames.length > 0
                        ? data.stateMachineNames.map(name => `<span class="badge">${name}</span>`).join('')
                        : '<p class="empty">Ingen state machines fundet</p>'}
                    ${data.playingStateMachineNames.length > 0
                        ? `<h3>Aktive:</h3>${data.playingStateMachineNames.map(name => `<span class="badge">${name}</span>`).join('')}`
                        : ''}
                </div>

                <!-- State Machine Inputs -->
                <div class="metadata-section">
                    <h2>üéÆ State Machine Inputs (${data.stateMachineInputs.length})</h2>
                    ${data.stateMachineInputs.length > 0
                        ? `<ul class="metadata-list">
                            ${data.stateMachineInputs.map(input => `
                                <li>
                                    <span class="badge ${input.type}">${input.type}</span>
                                    <strong>${input.name}</strong>
                                    <br><span class="label">State Machine:</span> <span class="value">${input.stateMachine}</span>
                                    <br><span class="label">Current Value:</span> <span class="value">${input.value}</span>
                                </li>
                            `).join('')}
                        </ul>`
                        : '<p class="empty">Ingen State Machine inputs fundet</p>'}
                </div>

                <!-- All Properties (Debug) -->
                <div class="metadata-section">
                    <h2>üîç All Available Properties (${data.allProperties.length})</h2>
                    <p style="color: #666; font-size: 14px; margin-bottom: 10px;">Dette viser ALLE properties p√• Rive instance objektet. Check konsollen for fuld detalje.</p>
                    ${data.allProperties.length > 0
                        ? `<ul class="metadata-list" style="max-height: 300px; overflow-y: auto;">
                            ${data.allProperties.map(prop => `
                                <li>
                                    <strong>${prop.name}</strong>
                                    <br><span class="label">Type:</span> <span class="value">${prop.type}</span>
                                    <br><span class="label">Value:</span> <span class="value" style="word-break: break-all;">${JSON.stringify(prop.value)}</span>
                                </li>
                            `).join('')}
                        </ul>`
                        : '<p class="empty">Ingen properties fundet</p>'}
                </div>

                <!-- Layout Info -->
                <div class="metadata-section">
                    <h2>üìê Layout & Bounds</h2>
                    <ul class="metadata-list">
                        <li><span class="label">Bounds:</span> <span class="value">${JSON.stringify(data.bounds)}</span></li>
                    </ul>
                </div>

                <!-- Raw JSON -->
                <div class="metadata-section" style="grid-column: 1 / -1;">
                    <h2>üìÑ Raw JSON Output</h2>
                    <pre class="json-output">${JSON.stringify(data, null, 2)}</pre>
                </div>

                <!-- Console Instructions -->
                <div class="metadata-section" style="grid-column: 1 / -1; background: #fffbeb; border-left-color: #f59e0b;">
                    <h2>üí° Brug Browser Console for mere info</h2>
                    <p>√Öbn DevTools (F12) og check konsollen - der er printet den fulde Rive instance.</p>
                    <p style="margin-top: 10px;">Pr√∏v at k√∏re f√∏lgende i konsollen:</p>
                    <pre class="json-output" style="background: #1f2937; margin-top: 10px;">// Adgang til Rive instance (gem reference globalt)
window.currentRive = riveInstance;

// Inspic√©r i konsollen:
console.log(window.currentRive);</pre>
                </div>
            `;

            container.innerHTML = html;

            // Make Rive instance globally accessible for console debugging
            window.currentRive = riveInstance;
            console.log('‚úÖ Rive instance er nu tilg√¶ngelig som: window.currentRive');
        }
    </script>
</body>
</html>
